[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700

[supervisord]
nodaemon=true
logfile=/tmp/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=/tmp
silent=false
loglevel=info
# Use select instead of kqueue on macOS to avoid polling errors
minfds=1024
minprocs=200

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:queue_workers]
directory=%(here)s/..
command=python3 scripts/worker_wrapper.py
process_name=%(program_name)s_%(process_num)02d
numprocs=%(ENV_WORKER_COUNT)s
redirect_stderr=true
stdout_logfile=/tmp/worker_%(process_num)02d.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
autorestart=true
autostart=true
environment=WORKER_UID="worker-%(process_num)02d-%(ENV_WORKER_TYPE)s",DOWNLOADS_PATH="/tmp/cache/worker_%(process_num)02d",REDIS_HOST="127.0.0.1",REDIS_PORT="6379"
priority=3
startsecs=15
startretries=3
stopwaitsecs=45
stopsignal=TERM
killasgroup=true
stopasgroup=true


